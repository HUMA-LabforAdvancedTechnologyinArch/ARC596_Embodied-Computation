
# ARC596 - Tutorial 3 - Unity AR App


# Create an AR Test App

-   Open the file you created when following the **Installation Guide** using _Unity Hub_ on your computer or use the animation app you just made and delete the existing GameObjects.

>   Note: Be sure that the AR dependencies are installed per the prior section of this tutorial. 

## Configure an AR session and add AR Foundation components 

A scene needs an AR session to enable [AR processes](https://developers.google.com/ar/discover/concepts), such as motion tracking, environmental understanding, and lighting estimation. You will need the following game objects to support an AR session:

-   **AR Session**: Controls the lifecycle of an AR experience.
-   **XR Origin**: Transforms AR coordinates into Unity world coordinates.

1. Before adding the new game objects, delete the default **Main Camera**. It will be replaced by a new **Camera Offset** in the **XR Origin**.

    <img width="400" alt="" src="https://i.imgur.com/urNfYC2.jpg">

2. Add the new AR game objects to your scene: right-click the **Hierarchy** pane and select **XR**. Add a new **AR Session** and a new **XR Origin (Mobile AR)** game object.

    <img width="400" alt="" src="https://i.imgur.com/mTj3aiM.png">

**What is a Session?**

All [AR processes](https://developers.google.com/ar/discover/concepts), such as motion tracking, environmental understanding, and lighting estimation, happen inside an ARCore session. [ARSession](https://docs.unity3d.com/Packages/com.unity.xr.arfoundation@4.1/api/UnityEngine.XR.ARFoundation.ARSession.html) is the main entry point to the ARCore API. It manages the AR system state and handles the session **lifecycle**, allowing the app to create, configure, start, or stop a session. Most importantly, it enables the app to receive frames that allow access to the camera image and device pose.

-   Your _Hierarchy_ should now look like this:

    <img width="300" alt="" src="https://i.imgur.com/Dff422E.jpg">


-   Expand the **XR Origin** you created in the _Hierarchy_, and select the **Camera Offset**. In the inspector, change its _**Tag**_ to **MainCamera.**











## Detect planes in the real world  

### Add an ARPlane Manager Component and place an AR Plane Prefab 

An [ARPlaneManager](https://docs.unity3d.com/Packages/com.unity.xr.arfoundation@4.1/api/UnityEngine.XR.ARFoundation.ARPlaneManager.html) detects [ARPlanes](https://docs.unity3d.com/Packages/com.unity.xr.arfoundation@4.1/api/UnityEngine.XR.ARFoundation.ARPlane.html) and creates, updates, and removes game objects when the device's understanding of the environment changes.

-   Go to _Hierarchy_ and click on the **XR Origin** GameObject. On the _Inspector_ Window, click on **Add Component**, search** for the **AR Plane Manager** and **Add it**.
    
    <img width="650" alt="" src="https://i.imgur.com/fNk7yzI.png">

-   Respectively, click again on the **Add Component**, search for **AR Raycast Manager** and add it as well.

    <img width="650" alt="" src="https://i.imgur.com/9FdPqRR.jpg">

>   _We will need this component later. It helps obtain information of the raycasts deriving from the user input on the screen._

-   In the _Hierarchy Window_, right click , go to **XR > AR Default Plane**. This will create an AR-configured plane, that we will customize a bit and use as a Prefab for our application, in order to visualize the AR detected planes.

    <img width="400" alt="" src="https://i.imgur.com/4JfGt2v.jpg">
    <img width="400" alt="" src="https://i.imgur.com/c2x9s3s.jpg">

>   This _XR GameObject_ contains _scripts_ that generate and visualize the planes detected by the _AR device_, using the _AR Plane manager_ script we created in the previous step.

<img width="650" alt="" src="https://i.imgur.com/hsSC8WZ.jpg">

-   **AR Plane script summary:** Represents a plane (i.e., a flat surface) detected by an AR device. It is generated by the **ARPlaneManager** when an AR device detects a plane in the environment.
-   **AR Plane Mesh Visualizer Summary:** Generates a mesh for an \<ARPlane>. It generates a mesh and updates the boundary points with a \<LineRenderer>.

-   Now we will go to the Project Window, create a new empty **folder** in our **Assets,** and name it “Prefabs”, to organize our material. (**Right click > Create > Folder**). Then, double click it and go inside the folder.

    <img width="650" alt="" src="https://i.imgur.com/seVSYGo.jpg">
    <img width="400" alt="" src="https://i.imgur.com/LDdo0N4.jpg">

-   Drag and drop the **AR Default Plane**_GameObject inside the **Prefabs** folder, in order to save it as a _Prefab._ In general, this is an easy way to _create new Prefabs_, after we have edited them as we like in our _Scene._

    <img width="400" alt="" src="https://i.imgur.com/X31UXzS.jpg"> <img width="400" alt="" src="https://i.imgur.com/bFFt0iv.jpg">

>   Note: In short, Unity’s **Prefab** system allows you to create, configure, and store a GameObject complete with all its components, property values, and child **GameObjects** as a reusable Asset. The Prefab Asset acts as a template from which you can create new Prefab instances in the **Scene.**\
[**→ More info about prefabs**](https://docs.unity3d.com/Manual/Prefabs.html)

→ Notice that the _AR Default Plane_ becomes **blue** in the _Hierarchy._ This is because the process of creating the _Prefab Asset_ also turns the original _GameObject_ into a **Prefab instance**. Every change happening in the _prefab_, will happen in the _instance_ as well.

-   We can now **delete **the _AR Default Plane Object_ in the** Hierarchy,** since we will only use the** Prefab.**

    <img width="400" alt="" src="https://i.imgur.com/CAl6zPU.jpg">

-   On the **XR Origin** _GameObject_, go to the **AR Plane Manager Script** we added in Step 1. There is an _empty Plane Prefab._ Drag and Drop there the Prefab we created in the Assets.

    <img width="650" alt="" src="https://i.imgur.com/kr0ehLg.jpg">
    <img width="650" alt="" src="https://i.imgur.com/U3sGjsh.jpg">


You should now see the _AR Default Plane Prefab_ placed as the _Plane Prefab._

We can now visualize the AR detected planes in our device.

_**Let’s build the app and see if it works!**_













## Build the AR App to test the AR Plane detection 


### Configure Build and Project Settings in Unity

1. Select Android in build settings

	- Go to File > Build Settings
	
	- Switch to the Android Platform - Go to player settings
	
    	<img width="650" alt="" src="https://i.imgur.com/8H0ccdQ.jpg">	
	
    - If Unity requires you to download Android support in order to switch platforms, follow the link and install the required dependency. 
	
	- Go to Player > Other Settings > Rendering

	- Make sure “Auto Graphics API” is unchecked. Change Color Space to “Linear”
    
    - Remove Vulkan from under Graphics APIs
	
    	<img width="650" alt="" src="https://i.imgur.com/VXKjn0U.jpg">	
	
	- Go to Player > Other Settings > Package Name. Create a unique app ID using a Java package name format. For example, use com.Princeton.AR
	- Go to Player > Other Settings > Minimum API Level. Select Android 7.0 'Nougat' (API Level 24) or higher (For AR Optional apps, the Minimum API level is 14.)
	- Go to Player > Other Settings > Scripting Backend. Select IL2CPP instead of Mono.
	- Go to Player > Other Settings > Target Architectures. To meet the Google Play 64-bit requirement, enable ARM64 (64-bit ARM). Leave ARMv7 (32-bit ARM) enabled to support 32-bit devices

		<img width="650" alt="" src="https://i.imgur.com/nzciMsI.jpeg">		
	
2. Configure Project Settings
	
	- Open Edit > Project Settings... and click on the XR Plug-in Management section. In the Android tab, enable ARCore.

		<img width="650" alt="" src="https://i.imgur.com/ILVPZQS.jpg">	

3. Configure your phone to run the app

    -   Plug your Android AR Phone into your computer, using the USB cable.
    -   Make sure that your computer recognizes the device. You can check this in **This PC>Devices and drives**

        <img width="400" alt="" src="https://i.imgur.com/D2Uka63.jpg">
        
    -   If you don’t see it, try having the device unlocked when you plug it, and if USB options popup, select **Use USB to: Transfer files** on your phone screen.

        <img width="325" alt="" src="https://i.imgur.com/gPJS315.jpg">




    -   Go to **File>Build Settings**
    -   Respectively, you should be able to see your device detected in the _Run Device_ drop-down Menu. You can click _Refresh_ if you don’t see it right away.
        
        <img width="650" alt="" src="https://i.imgur.com/3Ca1jbE.jpg">
            

4. Build and run the app 

    -   Click **Build and Run**. Select a folder and name your application as desired. This might take a bit of time. Keep the device unlocked, so that the application runs right away.

        <img width="650" alt="" src="https://i.imgur.com/TkDSvNw.jpg">
        <img width="650" alt="" src="https://i.imgur.com/aM0a0cd.jpg">

    -   Move the phone **slowly** up and down, left and right, to start the detection.

    -   After some time, you should be able to see this _semi-transparent yellow material_ with an outline, indicating the **scanned AR Planes.**

















## Import a file into Unity from Rhino 

### Export file from Rhino 

In _Rhino_, open your desired file. In our case it is a house form. 

>   Note: Make sure you file is set to meters in Rhino. 

-   Move the **x,y center** of your geometry to **0,0,0**. You can use the _Move_ command, and and align it to the 0,0,0 plane. Have the x and y center at the origin, but the whole house should be above the ground plane.

    <img width="650" alt="" src="https://i.imgur.com/hoKzJwJ.jpg">



>   Note: This step will help us have our model correctly oriented in Unity.

-   Select the part(s) that you want to export

-   Go to **File>Export Selected**

    <img width="650" alt="" src="https://i.imgur.com/ksEujZ6.jpg">


-   Save as type **.obj,** in a folder that you can easily find e.g. another folder on your Desktop called _“Seminar\_Week\_Assets”,_ and click **“OK”** in the _OBJ Export Options_ dialog.

    <img width="400" alt="" src="https://i.imgur.com/i44CDCm.jpg"> <img height="400" alt="" src="https://i.imgur.com/4VGt7eH.jpg">

>   Note: Check that your file is created correctly in the folder.



### Import file in Unity

First, we will learn how to import our model correctly into _Unity_, adjust its scale and position it correctly. In this example, _Rhinoceros_ is a common CAD software, but you can use any preferred modeling software. Be sure to structure your model according to the materials you want to apply on it later. Unity understands a variety of file types, you can use **OBJ** and export each layer as a separate OBJ file.

Back in the existing Unity App, go to the Prefab folder we created before in the Assets (Project Window).

-   Go to the Assets folder of the Unity Project on your computer (in the file explorer) , and copy paste both the .obj and the .mtl. You can make a new folder called _ImportedObjects_.

>   Note: Unity Projects are actually folders that contain other folders. So you can have full access on Prefabs, scripts, objects. When you put something in this folder, it updates in Unity as well.

<img width="650" alt="" src="https://i.imgur.com/aWTnmDC.jpg"> <img width="300" alt="" src="https://i.imgur.com/3dBPLp3.jpg">



-   Inside the **ImportedObjects** folder, copy and paste both your **.obj** and the **.mtl** file that you exported from Rhino.

>   Note: Alternatively, you can make the new folder inside Unity and drag and drop both of the files.

-   Back to _Unity_, you will see that the folder is also updated in the **Project Window > Assets.**

    <img width="300" alt="" src="https://i.imgur.com/LDMloz8.jpg">

-   Inside the folder, you should be able to see an icon of your house in the _Prefabs._ Click on it once and go to the **Inspector Window.** Enable **Read/Write. Click “Apply”.**

    <img width="300" alt="" src="https://i.imgur.com/3mCDucc.jpg">
    <img height="650" alt="" src="https://i.imgur.com/kVlqxpc.jpg">

### Create Prefab with imported Model 

-   Drag and drop the house Prefab into the Hierarchy. You will now see the object imported in your Scene.

-   In the _Inspector_, make sure that the _Transform, Position and Rotation_ are set to **0,0,0.**

    <img width="650" alt="" src="https://i.imgur.com/uV27U56.jpg">

-   To check that the _Scale of the model_ we imported is correct. This is 1:1 in physical space. We can compare it with a **1,1,1** cube (1 x 1 x 1 meters) (**Create>3D Object>Cube**). If we see that the Cube is too big or too small, we have to scale our model. It is better to have an object that is small enough to fit in the phone camera.

-   To scale our model, we can click on the house prefab once, go to the Inspector, and type in the amount of desired scale (e.g. if your model was in milimeters, use 0.001). Click **Apply** on the bottom right.

    <img width="450" alt="" src="https://i.imgur.com/mx8lBET.jpg"> <img width="300" alt="" src="https://i.imgur.com/iUhHaGu.jpg">

>   Note: Don’t forget to Save your Project from time to time! **File > Save**

Now that the scale of the object is correct, we can apply a _Material_ of our choice. Let’s go back to **Assets** and make another **empty Folder** called **Materials**. Here we will be organizing our materials throughout the development.

>   Tip: You can rename an existing folder by clicking on it once, and pressing **F2** on your keyboard.

-   Inside the Materials folder, create a new Material (**Right Click > Create > Material**) Like the steps before, you can assign a color, or create multiple materials and assign them on your object.

-   When you are finished, Drag and Drop the object GameObject back to the **Assets>Prefabs**, and name it as _Building\_Prefab\_01_. Today, we will use this Prefab to instantiate it in the AR Detected Planes.

    <img width="250" alt="" src="https://i.imgur.com/Knla4qv.jpg">





















## Instantiate object 

_Now we can start the scripting base! The goal for today is to **“Tap and Instantiate”** the 3D object in our App, on the detected AR Planes._

### Import the Instantiator Script 

-   In the **Assets**, Create a new empty _Folder_ and name it _“Scripts”._ Here, we will be collecting all of the **C# scripts** we will be using.

-   Go to the folder for this tutorial which you downloaded. Select the  **Instantiator.cs** file, drag and drop the script into the _Script_ folder we created in Unity. This is the base script, that we will use to build our application upon.

    <img width="500" alt="" src="https://i.imgur.com/pxuAcQO.jpg">

-   Make an Empty Game Object and name it_ “Instantiator”. _Here we will assign our Instantiator script, where we manage the instances of the objects we create in the App.

    <img width="500" alt="" src="https://i.imgur.com/BHgvCc3.jpg">

-   On the **Instantiator** **GameObject**, go to the _Inspector_ and click on **Add Component**. Find and add the **Instantiator** script we imported in the previous steps.

    <img width="500" alt="" src="https://i.imgur.com/loTUPLM.jpg">

>   Note: Always make sure that the Transform Values are set to Zero when creating a new GameObject.

-   We see some defined variables that don’t have any object assigned to them. But first, let’s take a look at the **code.**

    <img width="500" alt="" src="https://i.imgur.com/S6nbhpH.jpg">


## Overview of the code 

-   To open the script, you can either go to **Assets>Scripts** and double click, or on the **component** itself, and **double click** on the name.

    <img width="500" alt="" src="https://i.imgur.com/WByAdzW.jpg">

    <img width="800" alt="" src="https://i.imgur.com/Czw4zBy.jpg">

Do these variables seem familiar? They are the ones that appear on the Inspector!



We can choose what kind of GameObject we need.

_E.g. For the Camera, we only need the “Transform” component, to get information about its position and rotation in space._

Let’s drag and drop the objects we need.

-   For the **Selected Prefab**, we can put the House Prefab we created, by dragging it from the **Assets>Prefabs** folder we created.
-   For the **AR Camera Transform**, we will drag and drop the **Camera Offset**, which we can find under **XR Origin** in the Hierarchy.

    <img width="250" alt="" src="https://i.imgur.com/FyMXSpT.jpg">

-   As we saw in the C# script, the **House Parent**, is an empty GameObject that will be the **parent** of all the instances we will create with our taps on the screen. So let’s create an **Empty GameObject** and name it **HouseParent**. Then, drag and drop it on the Instantiator Script.

    <img width="400" alt="" src="https://i.imgur.com/F8kJ0FG.jpg">

>   Note: Make sure the Transform is set to 0,0,0 in the Inspector for the new object. Likewise, make sure it is set to zero for the AR Session and XR Origin GameObjects. 

-   The Inspector should look like this

    <img width="400" alt="" src="https://i.imgur.com/ocgdox5.jpg">


## Build App 

-   We are ready to build the App and test it!

    <img width="650" alt="" src="https://i.imgur.com/DQhXQDs.jpg">






### Misc Information

1. MonoBehaviour is the base class from which every Unity script object derives its properties and methods (functions). 
2. A class enables you to create your custom types by grouping variables of other types, methods, and events. 
3. The API acronym stands for **Application Programming Interface**, which is a software intermediary that allows two applications to talk to each other.
4. Software Development Kits (SDKs) allow development for a variety of platforms. They contain the compiler and debugger and usually software frameworks. For example, Unity has the Android SDK, which allows you to build for the Android operating system. 
5. Tags help you link GameObjects to variables in your scripts.
